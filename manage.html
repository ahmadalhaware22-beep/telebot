<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨ÙˆØª</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(to right, #e0f7fa, #f1f8e9);
      padding: 30px;
      direction: rtl;
    }
    h1 {
      text-align: center;
      color: #2e7d32;
      margin-bottom: 30px;
      font-size: 28px;
    }
    .section {
      background: #ffffff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      max-width: 700px;
      margin: auto;
    }
    label { display: block; margin-top: 15px; font-weight: bold; color: #333; }
    input, select, textarea {
      padding: 10px; margin-top: 5px; width: 100%;
      border: 1px solid #ccc; border-radius: 8px; font-size: 15px;
      background-color: #f9f9f9; transition: border-color 0.3s;
    }
    input:focus, select:focus, textarea:focus { border-color: #4caf50; outline: none; background-color: #fff; }
    textarea { resize: vertical; }
    button {
      background: #4caf50; color: #fff; border: none;
      padding: 12px 24px; border-radius: 8px; margin-top: 20px;
      cursor: pointer; font-size: 16px; transition: background 0.3s;
    }
    button:hover { background: #388e3c; }
    .button-group { display: flex; justify-content: space-between; flex-wrap: wrap; }
  </style>
</head>
<body>
  <!-- Ù…Ø±Ø¨Ø¹ Ø¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
<div id="statsBox" style="margin:20px auto; padding:15px; border:1px solid #ccc; border-radius:8px; background:#f9f9f9; max-width:700px; text-align:center; font-size:18px;">
  ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: <span id="userCount">0</span>
  <button onclick="loadStats()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
</div>

  <h1>ğŸ›  Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨ÙˆØª</h1>
  <div class="section">
    <label>Ø§Ù„ØµÙ:</label>
    <select id="grade">
      <option>Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¨Ø¹</option><option>Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù…Ù†</option>
      <option>Ø§Ù„ØµÙ Ø§Ù„ØªØ§Ø³Ø¹</option><option>Ø§Ù„ØµÙ Ø§Ù„Ø¹Ø§Ø´Ø±</option>
      <option>Ø§Ù„ØµÙ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±</option><option>Ø§Ù„Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠØ§</option>
    </select>

    <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰:</label>
    <select id="mainOption" onchange="updateFields()">
      <option>ğŸ“˜ Ø´Ø±Ø­ Ø§Ù„Ù…Ù†Ù‡Ø§Ø¬</option>
      <option>ğŸ“ Ø£ÙˆØ±Ø§Ù‚ Ø¹Ù…Ù„</option>
      <option>ğŸ“š ÙƒØªØ¨ + Ø¯Ù„ÙŠÙ„</option>
      <option>â“ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª</option>
    </select>

    <div id="sectionField">
      <label>Ø§Ù„Ù‚Ø³Ù…:</label>
      <select id="section"><option>Ø§Ù„Ø¬Ø¨Ø±</option><option>Ø§Ù„Ù‡Ù†Ø¯Ø³Ø©</option></select>
    </div>

    <div id="unitField">
      <label>Ø±Ù‚Ù… Ø§Ù„ÙˆØ­Ø¯Ø©:</label>
      <input type="number" id="unit" min="1">
    </div>

    <div id="lessonField">
      <label>Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø³:</label>
      <input type="number" id="lesson" min="1">
    </div>

    <div id="bookGuideField">
      <label>Ø§Ø®ØªØ±:</label>
      <select id="bookGuide"><option>Ø§Ù„ÙƒØªØ§Ø¨</option><option>Ø§Ù„Ø¯Ù„ÙŠÙ„</option></select>
    </div>

    <div id="examYearField">
      <label>Ø³Ù†Ø© Ø§Ù„Ø¯ÙˆØ±Ø©:</label>
      <input type="text" id="examYear" placeholder="Ù…Ø«Ø§Ù„: Ø¯ÙˆØ±Ø© 2024">
    </div>

    <label>Ù†Øµ ÙŠØ¸Ù‡Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
    <textarea id="text" rows="3"></textarea>

    <label>Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
    <input type="url" id="link">

    <label>Ø±ÙØ¹ Ù…Ù„Ù (PDF/Video):</label>
    <input type="file" id="file">

    <div class="button-group">
      <button onclick="submitContent()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button>
      <button onclick="deleteContent()">ğŸ—‘ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button>
      <button onclick="resetBot()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ø¨ÙˆØª</button>
    </div>
  </div>

  <script>
    function updateFields() {
      const mainOption = document.getElementById("mainOption").value;
      document.getElementById("sectionField").style.display = "none";
      document.getElementById("unitField").style.display = "none";
      document.getElementById("lessonField").style.display = "none";
      document.getElementById("bookGuideField").style.display = "none";
      document.getElementById("examYearField").style.display = "none";

      if (mainOption === "ğŸ“˜ Ø´Ø±Ø­ Ø§Ù„Ù…Ù†Ù‡Ø§Ø¬") {
        document.getElementById("sectionField").style.display = "block";
        document.getElementById("unitField").style.display = "block";
        document.getElementById("lessonField").style.display = "block";
      } else if (mainOption === "ğŸ“ Ø£ÙˆØ±Ø§Ù‚ Ø¹Ù…Ù„") {
        document.getElementById("sectionField").style.display = "block";
        document.getElementById("unitField").style.display = "block";
      } else if (mainOption === "ğŸ“š ÙƒØªØ¨ + Ø¯Ù„ÙŠÙ„") {
        document.getElementById("sectionField").style.display = "block";
        document.getElementById("bookGuideField").style.display = "block";
      } else if (mainOption === "â“ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª") {
        document.getElementById("examYearField").style.display = "block";
      }
    }

    function buildKey() {
      const grade = document.getElementById("grade").value;
      const mainOption = document.getElementById("mainOption").value;
      const section = document.getElementById("section").value;
      const unit = document.getElementById("unit").value;
      const lesson = document.getElementById("lesson").value;
      const bookGuide = document.getElementById("bookGuide").value;
      const examYear = document.getElementById("examYear").value;

      let keyParts = [grade, mainOption];

      if (mainOption === "ğŸ“˜ Ø´Ø±Ø­ Ø§Ù„Ù…Ù†Ù‡Ø§Ø¬") {
        keyParts.push(section);
        if (unit) keyParts.push(`Ø§Ù„ÙˆØ­Ø¯Ø© ${unit}`);
        if (lesson) keyParts.push(`Ø§Ù„Ø¯Ø±Ø³ ${lesson}`);
      } else if (mainOption === "ğŸ“ Ø£ÙˆØ±Ø§Ù‚ Ø¹Ù…Ù„") {
        keyParts.push(section);
        if (unit) keyParts.push(`Ø§Ù„ÙˆØ­Ø¯Ø© ${unit}`);
      } else if (mainOption === "ğŸ“š ÙƒØªØ¨ + Ø¯Ù„ÙŠÙ„") {
        keyParts.push(section);
        keyParts.push(bookGuide);
      } else if (mainOption === "â“ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¯ÙˆØ±Ø§Øª") {
        if (examYear) keyParts.push(examYear);
      }

      return keyParts.join(".");
    }

    async function submitContent() {
      const key = buildKey();
      const text = document.getElementById("text").value;
      const link = document.getElementById("link").value;
      const file = document.getElementById("file").files[0];

      const formData = new FormData();
      formData.append("key", key);
      if (text) formData.append("text", text);
      if (link) formData.append("link", link);
      if (file) formData.append("file", file);

      try {
        const res = await fetch("/manage", { method: "POST", body: formData });
        const data = await res.json();
        alert(data.message);
      } catch (err) {
        alert("âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
      }
    }
    
    async function deleteContent() {
      const key = buildKey();
      try {
        const res = await fetch("/manage", {
          method: "DELETE",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ key })
        });
        const data = await res.json();
        alert(data.message);
      } catch (err) {
        alert("âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
      }
    }

    async function resetBot() {
      try {
        const res = await fetch("/manage", { method: "POST" });
        const data = await res.json();
        alert(data.message);
      } catch (err) {
        alert("âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
      }
    }
  async function loadStats() {
    try {
      const res = await fetch("/manage");
      const data = await res.json();
      document.getElementById("userCount").textContent = data.count;
    } catch (err) {
      alert("âš ï¸ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±");
    }
  }
  window.onload = function() {
    updateFields();   // Ù…ÙˆØ¬ÙˆØ¯Ø© Ø³Ø§Ø¨Ù‚Ù‹Ø§ Ù„ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø®ÙŠØ§Ø±
    loadStats();      // Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
  }

  </script>
</body>

</html
